<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v5.min.js"></script>
<style> /* set the CSS */

  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1px;
  }

  .redline {
    fill: none;
    stroke: red;
    stroke-width: 1px;
  }

  div.tooltip {	
    position: absolute;			
    text-align: left;			
    width: 200px;					
    height: 125px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}
  
  </style>
<body onload='init("1")'>
  <h1>COVID-19 Cases Trend in the USA</h1>
  <div>
    <button id="button_1" onclick="init('1')">First Case</button>
    <button id="button_2" onclick="init('2')">Peak</button>
    <button id="button_3" onclick="init('3')">Lowest</button>
</div>
 <svg id="covid_viz" style="overflow: visible"></svg>

<script>
  async function init(slide_num) {
    document.getElementById("covid_viz").innerHTML = "";
    document.getElementById("button_1").style = "";
    document.getElementById("button_2").style = "";
    document.getElementById("button_3").style = "";

    data = await d3.csv("https://raw.githubusercontent.com/venugopalthati/COVID19_US/gh-pages/us_covid_cases.csv");
    var startDate = '';
    var endDate = '';


  var margin = {top: 20, right: 20, bottom: 30, left: 50},
    width = 800 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
    
  var x = d3.scaleTime()
    .domain([new Date("01/01/2020"),new Date("08/01/2021")])
    .range([0, width]);
    
    var y = d3.scaleLinear()
    .domain([0, 400000])
    .range([height, 0]);

    var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);
    
    var svg = d3.select("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");


    if(slide_num == 1) {
      document.getElementById("button_1").style = "font-weight : bold ;";
      startDate = '01/01/2020';
      endDate = '05/01/2020';
      svg.append('line')
        .style("stroke", "GREY")
        .style("stroke-width", 2)
        .attr("x1", 25)
        .attr("y1", 350)
        .attr("x2", 50)
        .attr("y2", 275);
      
      svg.append('circle')
        .style("fill", "orange")
        .attr("cx", 25)
        .attr("cy", 350)
        .attr("r", 6);

      svg.append('text')
        .style("fill", "grey")
        .attr("x", 50)
        .attr("y", 260)
        .attr("font", 13)
        .text("CDC Reported First COVID-19 case on Jan 21, 2020");

    } else if (slide_num == 2) {
      document.getElementById("button_2").style = "font-weight : bold ;";
      startDate = '01/01/2020';
      endDate = '02/01/2021';

      svg.append('line')
        .style("stroke", "GREY")
        .style("stroke-width", 2)
        .attr("x1", 472)
        .attr("y1", 85)
        .attr("x2", 497)
        .attr("y2", 10);
      
      svg.append('circle')
        .style("fill", "orange")
        .attr("cx", 472)
        .attr("cy", 85)
        .attr("r", 6);

      svg.append('text')
        .style("fill", "grey")
        .attr("x", 495)
        .attr("y", 4)
        .attr("font", 13)
        .text("Peak number of COVID-19 cases (300777) report on Jan 8, 2021");

    } else if (slide_num == 3) {
      document.getElementById("button_3").style = "font-weight : bold ;";
      startDate = '01/01/2020';
      endDate = '08/01/2021';

      svg.append('line')
        .style("stroke", "GREY")
        .style("stroke-width", 2)
        .attr("x1", 695)
        .attr("y1", 345)
        .attr("x2", 720)
        .attr("y2", 270);
      
      svg.append('circle')
        .style("fill", "orange")
        .attr("cx", 695)
        .attr("cy", 345)
        .attr("r", 6);

      svg.append('text')
        .style("fill", "grey")
        .attr("x", 720)
        .attr("y", 260)
        .attr("font", 13)
        .text("Lowest number of COVID-19 cases (3491) reported on July 4, 2021");
    }
    
    data = data.filter( function(d){ return (new Date(d.date) > new Date(startDate) && new Date(d.date) < new Date(endDate))} );

    svg.append("g")
      .selectAll("circle")                 
      .data(data)
      .enter().append("circle")
      .attr("cx", function(d) { return x(new Date(d.date)); })
      .attr("cy", function(d) { return y(d.daily_cases); })
      .attr("r", 2)
      .attr("fill","steelblue")
      .on("mouseover",function onMouseOver(d, i) {
        d3.select(this).attr("fill", "orange").attr("r", 8);

        div.transition()		
                .duration(200)		
                .style("opacity", .9);		

        div.html("<table>"
              +"<tr><td> Date: </td> <td>"  + d.date + "</td></tr>"  
              +"<tr><td> Cases on this day: " + "</td> <td>"  + d.daily_cases + "</td></tr>"  
              +"<tr><td> Total cases until this date: " + "</td><td>" + d.cases + "</td></tr>" 
              +"<tr><td> Deaths on this day: " + "</td><td>" + d.daily_deaths + "</td></tr>" 
              +"<tr><td> Total deaths until this date: " + "</td><td>" + d.deaths + "</td></tr>" 
              +"</table>")
              .style("left", (d3.event.pageX) + "px")		
              .style("top", (d3.event.pageY - 30) + "px");

      })
      .on("mouseout",function onMouseOut(d, i) {
        d3.select(this).attr("fill", "steelblue").attr("r", 2);
	
        div.transition()		
            .duration(500)		
            .style("opacity", 0);
      });


    path = svg.append("path")
      .data([data])
      .attr("class", "line")
      .attr("d", 
          d3.line()
         .x(function(d) { return x(new Date(d.date)); })
         .y(function(d) { return y(d.daily_cases); }));
  
    
    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).ticks(20)
          .tickFormat(d3.timeFormat("%b-%y"))
        );

    svg.append("g")
      .call(d3.axisLeft(y).ticks(5));

  }
  
</script>
</body>
